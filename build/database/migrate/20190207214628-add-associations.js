'use strict';

function addProductAssociations(queryInterface, Sequelize) {
  //product belongsTo product_category
  return queryInterface.addColumn('products', 'product_category_id', {
    type: Sequelize.INTEGER,
    references: {
      model: 'product_categories',
      key: 'id'
    },
    onUpdate: 'CASCADE',
    onDelete: 'SET NULL'
  }).then(() => {
    //product_image belongsTo product
    return queryInterface.addColumn('product_images', 'product_id', {
      type: Sequelize.INTEGER,
      references: {
        model: 'products',
        key: 'id'
      },
      onUpdate: 'CASCADE',
      onDelete: 'CASCADE'
    });
  });
}

function removeProductsAssociation(queryInterface, Sequelize) {
  //remove products belongsTo product_category
  return queryInterface.removeColumn('products', 'product_category_id').then(() => {
    //remove product_image belongsTo product
    'product_images', 'product_id';
  });
}

function addUserAssociations(queryInterface, Sequelize) {
  //user_address belongsTo user
  return queryInterface.addColumn('user_addresses', 'user_id', {
    type: Sequelize.INTEGER,
    references: {
      model: 'users',
      key: 'id'
    },
    onUpdate: 'CASCADE',
    onDelete: 'CASCADE'
  }).then(() => {
    //order belongsTo user
    return queryInterface.addColumn('orders', 'user_id', {
      type: Sequelize.INTEGER,
      references: {
        model: 'users',
        key: 'id'
      },
      onUpdate: 'CASCADE',
      onDelete: 'SET NULL'
    });
  });
}

function removeUsersAssociation(queryInterface, Sequelize) {
  //remove user_address belongsTo user
  return queryInterface.removeColumn('user_addresses', 'user_id').then(() => {
    //remove order belongsTo user
    'orders', 'user_id';
  });
}

function addOrdersAssociations(queryInterface, Sequelize) {
  //order_items belongsTo order
  return queryInterface.addColumn('order_items', 'order_id', {
    type: Sequelize.INTEGER,
    references: {
      model: 'orders',
      key: 'id'
    },
    onUpdate: 'CASCADE',
    onDelete: 'CASCADE'
  }).then(() => {
    //order belongsTo order_addresses
    return queryInterface.addColumn('orders', 'shipping_address_id', {
      type: Sequelize.INTEGER,
      references: {
        model: 'order_addresses',
        key: 'id'
      },
      onUpdate: 'CASCADE',
      onDelete: 'CASCADE'
    });
  }).then(() => {
    //order belongsTo order_addresses
    return queryInterface.addColumn('orders', 'billing_address_id', {
      type: Sequelize.INTEGER,
      references: {
        model: 'order_addresses',
        key: 'id'
      },
      onUpdate: 'CASCADE',
      onDelete: 'CASCADE'
    });
  });
}

function removeOrdersAssociation(queryInterface, Sequelize) {
  //remove orders_items belongsTo order
  return queryInterface.removeColumn('orders_items', 'order_id').then(() => {
    //remove order belongsTo order_addresses
    'orders', 'shipping_address_id';
  }).then(() => {
    //remove order belongsTo order_addresses
    'orders', 'billing_address_id';
  });
}

module.exports = {
  up: (queryInterface, Sequelize) => {
    return addProductAssociations(queryInterface, Sequelize).then(() => {
      return addUserAssociations(queryInterface, Sequelize).then(() => {
        return addOrdersAssociations(queryInterface, Sequelize);
      });
    });
  },
  down: (queryInterface, Sequelize) => {
    return removeProductsAssociation(queryInterface, Sequelize).then(() => {
      return removeUsersAssociation(queryInterface, Sequelize).then(() => {
        return removeOrdersAssociation(queryInterface, Sequelize);
      });
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhYmFzZS9taWdyYXRlLzIwMTkwMjA3MjE0NjI4LWFkZC1hc3NvY2lhdGlvbnMuanMiXSwibmFtZXMiOlsiYWRkUHJvZHVjdEFzc29jaWF0aW9ucyIsInF1ZXJ5SW50ZXJmYWNlIiwiU2VxdWVsaXplIiwiYWRkQ29sdW1uIiwidHlwZSIsIklOVEVHRVIiLCJyZWZlcmVuY2VzIiwibW9kZWwiLCJrZXkiLCJvblVwZGF0ZSIsIm9uRGVsZXRlIiwidGhlbiIsInJlbW92ZVByb2R1Y3RzQXNzb2NpYXRpb24iLCJyZW1vdmVDb2x1bW4iLCJhZGRVc2VyQXNzb2NpYXRpb25zIiwicmVtb3ZlVXNlcnNBc3NvY2lhdGlvbiIsImFkZE9yZGVyc0Fzc29jaWF0aW9ucyIsInJlbW92ZU9yZGVyc0Fzc29jaWF0aW9uIiwibW9kdWxlIiwiZXhwb3J0cyIsInVwIiwiZG93biJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsU0FBU0Esc0JBQVQsQ0FBa0NDLGNBQWxDLEVBQWtEQyxTQUFsRCxFQUE2RDtBQUMzRDtBQUNBLFNBQU9ELGNBQWMsQ0FBQ0UsU0FBZixDQUNMLFVBREssRUFFTCxxQkFGSyxFQUdMO0FBQ0VDLElBQUFBLElBQUksRUFBRUYsU0FBUyxDQUFDRyxPQURsQjtBQUVFQyxJQUFBQSxVQUFVLEVBQ1Y7QUFDRUMsTUFBQUEsS0FBSyxFQUFFLG9CQURUO0FBRUVDLE1BQUFBLEdBQUcsRUFBRTtBQUZQLEtBSEY7QUFPRUMsSUFBQUEsUUFBUSxFQUFFLFNBUFo7QUFRRUMsSUFBQUEsUUFBUSxFQUFFO0FBUlosR0FISyxFQWNOQyxJQWRNLENBY0QsTUFBTTtBQUNWO0FBQ0EsV0FBT1YsY0FBYyxDQUFDRSxTQUFmLENBQ0wsZ0JBREssRUFFTCxZQUZLLEVBR0w7QUFDRUMsTUFBQUEsSUFBSSxFQUFFRixTQUFTLENBQUNHLE9BRGxCO0FBRUVDLE1BQUFBLFVBQVUsRUFDVjtBQUNFQyxRQUFBQSxLQUFLLEVBQUUsVUFEVDtBQUVFQyxRQUFBQSxH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J3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBhZGRQcm9kdWN0QXNzb2NpYXRpb25zICggcXVlcnlJbnRlcmZhY2UsIFNlcXVlbGl6ZSkge1xuICAvL3Byb2R1Y3QgYmVsb25nc1RvIHByb2R1Y3RfY2F0ZWdvcnlcbiAgcmV0dXJuIHF1ZXJ5SW50ZXJmYWNlLmFkZENvbHVtbiAoXG4gICAgJ3Byb2R1Y3RzJyxcbiAgICAncHJvZHVjdF9jYXRlZ29yeV9pZCcsXG4gICAgeyBcbiAgICAgIHR5cGU6IFNlcXVlbGl6ZS5JTlRFR0VSLFxuICAgICAgcmVmZXJlbmNlczogXG4gICAgICB7IFxuICAgICAgICBtb2RlbDogJ3Byb2R1Y3RfY2F0ZWdvcmllcycsXG4gICAgICAgIGtleTogJ2lkJ1xuICAgICAgfSxcbiAgICAgIG9uVXBkYXRlOiAnQ0FTQ0FERScsXG4gICAgICBvbkRlbGV0ZTogJ1NFVCBOVUxMJ1xuICAgIH1cbiAgKVxuICAudGhlbigoKSA9PiB7XG4gICAgLy9wcm9kdWN0X2ltYWdlIGJlbG9uZ3NUbyBwcm9kdWN0XG4gICAgcmV0dXJuIHF1ZXJ5SW50ZXJmYWNlLmFkZENvbHVtbiAoXG4gICAgICAncHJvZHVjdF9pbWFnZXMnLFxuICAgICAgJ3Byb2R1Y3RfaWQnLFxuICAgICAge1xuICAgICAgICB0eXBlOiBTZXF1ZWxpemUuSU5URUdFUixcbiAgICAgICAgcmVmZXJlbmNlczpcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsOiAncHJvZHVjdHMnLFxuICAgICAgICAgIGtleTogJ2lkJ1xuICAgICAgICB9LFxuICAgICAgICBvblVwZGF0ZTogJ0NBU0NBREUnLFxuICAgICAgICBvbkRlbGV0ZTogJ0NBU0NBREUnXG4gICAgICB9XG4gICAgKVxuICB9KVxufVxuXG5mdW5jdGlvbiByZW1vdmVQcm9kdWN0c0Fzc29jaWF0aW9uIChxdWVyeUludGVyZmFjZSwgU2VxdWVsaXplKSB7XG4vL3JlbW92ZSBwcm9kdWN0cyBiZWxvbmdzVG8gcHJvZHVjdF9jYXRlZ29yeVxuICByZXR1cm4gcXVlcnlJbnRlcmZhY2UucmVtb3ZlQ29sdW1uKFxuICAgICdwcm9kdWN0cycsXG4gICAgJ3Byb2R1Y3RfY2F0ZWdvcnlfaWQnXG4gIClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICAvL3JlbW92ZSBwcm9kdWN0X2ltYWdlIGJlbG9uZ3NUbyBwcm9kdWN0XG4gICAgICAncHJvZHVjdF9pbWFnZXMnLFxuICAgICAgJ3Byb2R1Y3RfaWQnXG4gICAgfSlcbn1cblxuZnVuY3Rpb24gYWRkVXNlckFzc29jaWF0aW9ucyAocXVlcnlJbnRlcmZhY2UsIFNlcXVlbGl6ZSkge1xuICAvL3VzZXJfYWRkcmVzcyBiZWxvbmdzVG8gdXNlclxuICByZXR1cm4gcXVlcnlJbnRlcmZhY2UuYWRkQ29sdW1uIChcbiAgICAndXNlcl9hZGRyZXNzZXMnLFxuICAgICd1c2VyX2lkJyxcbiAgICB7IFxuICAgICAgdHlwZTogU2VxdWVsaXplLklOVEVHRVIsXG4gICAgICByZWZlcmVuY2VzOiBcbiAgICAgIHsgXG4gICAgICAgIG1vZGVsOiAndXNlcnMnLFxuICAgICAgICBrZXk6ICdpZCdcbiAgICAgIH0sXG4gICAgICBvblVwZGF0ZTogJ0NBU0NBREUnLFxuICAgICAgb25EZWxldGU6ICdDQVNDQURFJ1xuICAgIH1cbiAgKVxuICAudGhlbigoKSA9PiB7XG4gICAgLy9vcmRlciBiZWxvbmdzVG8gdXNlclxuICAgIHJldHVybiBxdWVyeUludGVyZmFjZS5hZGRDb2x1bW4gKFxuICAgICAgJ29yZGVycycsXG4gICAgICAndXNlcl9pZCcsXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFNlcXVlbGl6ZS5JTlRFR0VSLFxuICAgICAgICByZWZlcmVuY2VzOlxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWw6ICd1c2VycycsXG4gICAgICAgICAga2V5OiAnaWQnXG4gICAgICAgIH0sXG4gICAgICAgIG9uVXBkYXRlOiAnQ0FTQ0FERScsXG4gICAgICAgIG9uRGVsZXRlOiAnU0VUIE5VTEwnXG4gICAgICB9XG4gICAgKVxuICB9KVxufVxuXG5mdW5jdGlvbiByZW1vdmVVc2Vyc0Fzc29jaWF0aW9uIChxdWVyeUludGVyZmFjZSwgU2VxdWVsaXplKSB7XG4gIC8vcmVtb3ZlIHVzZXJfYWRkcmVzcyBiZWxvbmdzVG8gdXNlclxuICAgIHJldHVybiBxdWVyeUludGVyZmFjZS5yZW1vdmVDb2x1bW4oXG4gICAgICAndXNlcl9hZGRyZXNzZXMnLFxuICAgICAgJ3VzZXJfaWQnXG4gICAgKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAvL3JlbW92ZSBvcmRlciBiZWxvbmdzVG8gdXNlclxuICAgICAgICAnb3JkZXJzJyxcbiAgICAgICAgJ3VzZXJfaWQnXG4gICAgICB9KVxufVxuXG5mdW5jdGlvbiBhZGRPcmRlcnNBc3NvY2lhdGlvbnMgKCBxdWVyeUludGVyZmFjZSwgU2VxdWVsaXplKSB7XG4gIC8vb3JkZXJfaXRlbXMgYmVsb25nc1RvIG9yZGVyXG4gIHJldHVybiBxdWVyeUludGVyZmFjZS5hZGRDb2x1bW4gKFxuICAgICdvcmRlcl9pdGVtcycsXG4gICAgJ29yZGVyX2lkJyxcbiAgICB7IFxuICAgICAgdHlwZTogU2VxdWVsaXplLklOVEVHRVIsXG4gICAgICByZWZlcmVuY2VzOiBcbiAgICAgIHsgXG4gICAgICAgIG1vZGVsOiAnb3JkZXJzJyxcbiAgICAgICAga2V5OiAnaWQnXG4gICAgICB9LFxuICAgICAgb25VcGRhdGU6ICdDQVNDQURFJyxcbiAgICAgIG9uRGVsZXRlOiAnQ0FTQ0FERSdcbiAgICB9XG4gIClcbiAgLnRoZW4oKCkgPT4ge1xuICAgIC8vb3JkZXIgYmVsb25nc1RvIG9yZGVyX2FkZHJlc3Nlc1xuICAgIHJldHVybiBxdWVyeUludGVyZmFjZS5hZGRDb2x1bW4gKFxuICAgICAgJ29yZGVycycsXG4gICAgICAnc2hpcHBpbmdfYWRkcmVzc19pZCcsXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFNlcXVlbGl6ZS5JTlRFR0VSLFxuICAgICAgICByZWZlcmVuY2VzOlxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWw6ICdvcmRlcl9hZGRyZXNzZXMnLFxuICAgICAgICAgIGtleTogJ2lkJ1xuICAgICAgICB9LFxuICAgICAgICBvblVwZGF0ZTogJ0NBU0NBREUnLFxuICAgICAgICBvbkRlbGV0ZTogJ0NBU0NBREUnXG4gICAgICB9XG4gICAgKVxuICB9KVxuICAudGhlbigoKSA9PiB7XG4gICAgLy9vcmRlciBiZWxvbmdzVG8gb3JkZXJfYWRkcmVzc2VzXG4gICAgcmV0dXJuIHF1ZXJ5SW50ZXJmYWNlLmFkZENvbHVtbiAoXG4gICAgICAnb3JkZXJzJyxcbiAgICAgICdiaWxsaW5nX2FkZHJlc3NfaWQnLFxuICAgICAge1xuICAgICAgICB0eXBlOiBTZXF1ZWxpemUuSU5URUdFUixcbiAgICAgICAgcmVmZXJlbmNlczpcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsOiAnb3JkZXJfYWRkcmVzc2VzJyxcbiAgICAgICAgICBrZXk6ICdpZCdcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGRhdGU6ICdDQVNDQURFJyxcbiAgICAgICAgb25EZWxldGU6ICdDQVNDQURFJ1xuICAgICAgfVxuICAgIClcbiAgfSlcbn1cblxuZnVuY3Rpb24gcmVtb3ZlT3JkZXJzQXNzb2NpYXRpb24gKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpIHtcbiAgLy9yZW1vdmUgb3JkZXJzX2l0ZW1zIGJlbG9uZ3NUbyBvcmRlclxuICAgIHJldHVybiBxdWVyeUludGVyZmFjZS5yZW1vdmVDb2x1bW4oXG4gICAgICAnb3JkZXJzX2l0ZW1zJyxcbiAgICAgICdvcmRlcl9pZCdcbiAgICApXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIC8vcmVtb3ZlIG9yZGVyIGJlbG9uZ3NUbyBvcmRlcl9hZGRyZXNzZXNcbiAgICAgICAgJ29yZGVycycsXG4gICAgICAgICdzaGlwcGluZ19hZGRyZXNzX2lkJ1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgLy9yZW1vdmUgb3JkZXIgYmVsb25nc1RvIG9yZGVyX2FkZHJlc3Nlc1xuICAgICAgICAnb3JkZXJzJyxcbiAgICAgICAgJ2JpbGxpbmdfYWRkcmVzc19pZCdcbiAgICAgIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICB1cDogKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpID0+IHtcblxuICAgIHJldHVybiBhZGRQcm9kdWN0QXNzb2NpYXRpb25zKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpXG4gICAgICAudGhlbiAoKCkgPT4ge1xuICAgICAgICByZXR1cm4gYWRkVXNlckFzc29jaWF0aW9ucyhxdWVyeUludGVyZmFjZSwgU2VxdWVsaXplKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFkZE9yZGVyc0Fzc29jaWF0aW9ucyhxdWVyeUludGVyZmFjZSwgU2VxdWVsaXplKVxuICAgICAgICB9KVxuICAgICAgfSkgICAgXG4gIH0sXG5cbiAgZG93bjogKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpID0+IHtcblxuICAgIHJldHVybiByZW1vdmVQcm9kdWN0c0Fzc29jaWF0aW9uKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiByZW1vdmVVc2Vyc0Fzc29jaWF0aW9uKHF1ZXJ5SW50ZXJmYWNlLCBTZXF1ZWxpemUpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVtb3ZlT3JkZXJzQXNzb2NpYXRpb24ocXVlcnlJbnRlcmZhY2UsIFNlcXVlbGl6ZSlcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gIH1cbn07XG4iXX0=